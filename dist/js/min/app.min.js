var app={init:function(){app.createMap()},createMap:function(){window.onload=function(){function e(){var e=L.latLng(t,a);c=new L.circle(e,1609,{color:"#DAA520",fillColor:"#DAA520",fillOpacity:.1}).addTo(i),c.bringToBack(),m=L.circleMarker(e,{stroke:!1,fillColor:"#DAA520",fillOpacity:.5}).addTo(i);var r="SELECT * FROM shootings_near_you_ob_gva WHERE killed = 0 AND ST_Distance(the_geom, ST_GeomFromText('POINT("+a+" "+t+")', 4326), true) < 1609",l="SELECT * FROM shootings_near_you_ob_gva WHERE killed != 0 AND ST_Distance(the_geom, ST_GeomFromText('POINT("+a+" "+t+")', 4326), true) < 1609",n=parseFloat(t)-.005,s=parseFloat(a),d=13;i.setView([n,s],d,{animation:!0}),o(r,l)}function o(e,o){var t=0,a=0;$.getJSON("https://baltsun.cartodb.com/api/v2/sql/?q="+e,function(e){$.each(e.rows,function(){t++}),$.getJSON("https://baltsun.cartodb.com/api/v2/sql/?q="+o,function(e){$.each(e.rows,function(e,o){a+=o.killed,t++}),1==t?$(".incidentsPlural").hide():$(".incidentsPlural").show(),$(".incidentsNumber").text(t),$(".homicidesNumber").text(a)})})}var t=document.getElementsByTagName("html")[0].getAttribute("data-lat"),a=document.getElementsByTagName("html")[0].getAttribute("data-lon"),r={center:[t,a],zoom:12,touchZoom:!1,scrollWheelZoom:!1,zoomControl:!1,doubleClickZoom:!1,boxZoom:!1,attributionControl:!1,dragging:!1},i=new L.Map("homicideMap",r);L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}).addTo(i);var l=[],n={user_name:"baltsun",type:"cartodb",sublayers:[{sql:"SELECT * FROM shootings_near_you_ob_gva",cartocss:"#md_shootings_near_you[killed=0]{marker-fill-opacity: 1;marker-line-color: #daa520;marker-line-width: 1;marker-line-opacity: 1;marker-placement: point;marker-type: ellipse;marker-width: 4;marker-fill: #fff;marker-allow-overlap: true;[zoom>13]{marker-width: 8;}}#md_shootings_near_you[killed!=0]{marker-fill-opacity: 1;marker-line-color: #900020;marker-line-width: 1;marker-line-opacity: 1;marker-placement: point;marker-type: ellipse;marker-width: 4;marker-fill: #fff;marker-allow-overlap: true;[zoom>13]{marker-width: 8;}}"}]};l=[],cartodb.createLayer(i,n,{cartodb_logo:!1}).addTo(i).error(function(e){console.log("error: "+e)});var c,m;e()}}};$(document).ready(function(){app.init()});